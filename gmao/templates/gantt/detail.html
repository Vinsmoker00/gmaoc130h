{% extends 'layout.html' %}
{% block title %}Gantt - {{ visit.name }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gantt.css') }}">
{% endblock %}

{% block page_header %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
  <div>
    <h1 class="h3 mb-1">{{ visit.name }}</h1>
    <p class="text-muted mb-0">Chronologie des tâches pour la visite {{ visit.vp_type }} débutant le {{ visit.start_date.strftime('%d/%m/%Y') }}.</p>
  </div>
  <div class="ms-md-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        Autre visite
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        {% set current_visit = (request.view_args or {}).get('visit_id') %}
        {% for label, endpoint in gantt_visit_selector %}
          <li><a class="dropdown-item{% if request.endpoint == 'gantt.detail' and current_visit == visit.id %} active{% endif %}" href="{{ endpoint }}">{{ label }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block page_content %}
<div class="card shadow-sm" id="gantt-root" data-endpoint="{{ url_for('gantt.visit_data', visit_id=visit.id) }}">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <span class="badge bg-danger me-2">Chemin critique</span>
        <span class="badge bg-primary">Tâche planifiée</span>
      </div>
      <small class="text-muted" data-role="generated-at"></small>
    </div>
    <div class="gantt-wrapper">
      <div class="gantt-sidebar" data-role="sidebar"></div>
      <div class="gantt-chart" data-role="chart">
        <div class="text-center text-muted py-5" data-role="placeholder">
          Chargement des données de la visite…
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/gantt.js') }}"></script>
{% endblock %}
